name: Validate Path References

on:
  push:
    branches: ['**']
  pull_request:
    branches: ['**']

jobs:
  validate-paths:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Check for deprecated .claude/skills references
        run: |
          echo "Checking for deprecated .claude/skills references..."
          if grep -r "\.claude/skills" --include="*.md" --include="*.yml" --include="*.yaml" --include="*.js" --include="*.sh" . 2>/dev/null | grep -v ".github/workflows/validate-paths.yml"; then
            echo "❌ ERROR: Found deprecated .claude/skills references"
            echo "Please use .web-agency/skills instead"
            exit 1
          fi
          echo "✅ No deprecated .claude/skills references found"

      - name: Check for deprecated .claude/learnings references
        run: |
          echo "Checking for deprecated .claude/learnings references..."
          if grep -r "\.claude/learnings" --include="*.md" --include="*.yml" --include="*.yaml" --include="*.js" --include="*.sh" . 2>/dev/null | grep -v ".github/workflows/validate-paths.yml"; then
            echo "❌ ERROR: Found deprecated .claude/learnings references"
            echo "Please use .web-agency/learnings instead"
            exit 1
          fi
          echo "✅ No deprecated .claude/learnings references found"

      - name: Validate .web-agency structure exists
        run: |
          echo "Validating .web-agency structure..."
          if [ ! -d ".web-agency/skills" ]; then
            echo "❌ ERROR: .web-agency/skills directory not found"
            exit 1
          fi
          if [ ! -d ".web-agency/learnings" ]; then
            echo "❌ ERROR: .web-agency/learnings directory not found"
            exit 1
          fi
          echo "✅ .web-agency structure is valid"
